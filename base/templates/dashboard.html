{% extends "base/base.html" %}

{% load static %}
{% block title %}Accueil{% endblock %}

{% block css %}
<style>
    #categories-chart {
        width: 100%;
        height: 400px;
    }
</style>
{% endblock css %}

{% block toolbar %}
<div id="kt_app_toolbar" class="app-toolbar" style="height: 50px">
    <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex flex-stack">
        <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
            <ul class="nav nav-custom nav-tabs nav-line-tabs nav-line-tabs-2x border-0 fs-4 fw-semibold mb-8 mt-8">
                <li class="nav-item text-end">
                    <a class="nav-link text-active-primary active" data-bs-toggle="tab" href="#kt_customer_view_overview_tab">Accueil</a>
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div id="categories-chart"></div>
{% endblock content %}

{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('categories-chart').getContext('2d');
        const categories = {{ categories|safe }};
        
        const data = {
            labels: categories.map(cat => cat.nom_cat),
            datasets: [{
                label: 'Nombre de Produits par Catégorie',
                data: categories.map(cat => cat.product_count),
                borderColor: '#36A2EB',
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                fill: false,
                tension: 0.1
            }]
        };

        new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: true
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return tooltipItem.label + ': ' + tooltipItem.raw + ' produits';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Catégorie'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Nombre de Produits'
                        },
                        beginAtZero: true
                    }
                }
            }
        });
    });
</script>
{% endblock %}
